<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Spring Boot WebSocket Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.0/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .input-group { margin: 10px 0; }
        input[type="text"], input[type="number"] {
            padding: 8px; margin: 5px; width: 200px;
        }
        button {
            padding: 10px 15px; margin: 5px;
            background-color: #007bff; color: white;
            border: none; border-radius: 4px; cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #messages {
            border: 1px solid #ccc; height: 400px;
            overflow-y: auto; padding: 10px; margin: 20px 0;
            background-color: #f9f9f9;
        }
        .message { margin: 5px 0; padding: 5px; }
        .my-message { text-align: right; color: #007bff; }
        .other-message { text-align: left; color: #333; }
        .error-message { color: red; font-weight: bold; }
        .system-message { color: green; font-style: italic; }
        .status { margin: 10px 0; padding: 10px; background-color: #e9ecef; border-radius: 4px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Spring Boot WebSocket Chat Test</h1>

    <div class="status">
        <strong>ì—°ê²° ìƒíƒœ:</strong> <span id="connectionStatus">ì—°ê²° ì¤‘...</span>
    </div>

    <div class="input-group">
        <h3>ì‚¬ìš©ì ì •ë³´</h3>
        <div style="margin-bottom: 10px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;">
            <strong>ğŸ’¡ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ:</strong><br>
            â€¢ <strong>íƒ­ 1 (ê²Œì‹œê¸€ ì‘ì„±ì)</strong>: ì´ë¦„=ì‚¬ìš©ì1, ì´ë©”ì¼=user1@user.com<br>
            â€¢ <strong>íƒ­ 2 (ì±„íŒ… ì‹ ì²­ì)</strong>: ì´ë¦„=ì‚¬ìš©ì2, ì´ë©”ì¼=user2@user.com<br>
            ê° íƒ­ì—ì„œ í•´ë‹¹ ì‚¬ìš©ì ì •ë³´ë¡œ ìˆ˜ì •í•œ í›„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”!<br><br>
            <strong>ğŸ“ ì‚¬ìš©ì2 ì •ë³´:</strong><br>
            JWT Token: <code style="font-size: 12px;">eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMkB1c2VyLmNvbSIsImlkIjo0LCJyb2xlIjoiVVNFUiIsImlhdCI6MTc1Mzc2OTk5NiwiZXhwIjoxNzUzNzcxNzk2fQ.UEmZ7n-r1VstflEaGpdi2fDxKjywJzrN83fkCwh9fkI</code>
        </div>
        <input type="text" id="senderName" placeholder="Your name" value="ì‚¬ìš©ì1">
        <input type="text" id="senderEmail" placeholder="Your email" value="user1@user.com">
        <input type="text" id="jwtToken" placeholder="JWT Token" value="eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMUB1c2VyLmNvbSIsImlkIjozLCJyb2xlIjoiVVNFUiIsImlhdCI6MTc1Mzc2OTk5NiwiZXhwIjoxNzUzNzcxNzk2fQ.example_token_for_user1" style="width: 400px;">
    </div>

    <div class="input-group">
        <h3>ì±„íŒ…ë°© ê´€ë¦¬</h3>
        <input type="number" id="postId" placeholder="Post ID" value="1">
        <button onclick="createAndJoinChatRoom()" id="createBtn">Create & Join Chat Room</button>
        <button onclick="loadMyChatRooms()">ë‚´ ì±„íŒ…ë°© ëª©ë¡</button>
    </div>

    <div class="input-group">
        <h3>ë©”ì‹œì§€ ì „ì†¡</h3>
        <input type="text" id="messageInput" placeholder="Message" onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()" id="sendBtn" disabled>Send Message</button>
        <button onclick="loadChatHistory()" id="historyBtn" disabled>Load Chat History</button>
    </div>

    <div class="status">
        <strong>í˜„ì¬ ì±„íŒ…ë°©:</strong> <span id="currentChatRoom">ì—†ìŒ</span>
    </div>

    <div id="messages"></div>
</div>

<script>
    var stompClient = null;
    var currentChatRoomId = null;
    var currentUserEmail = null;
    var isConnected = false;

    function updateConnectionStatus(status) {
        document.getElementById('connectionStatus').textContent = status;
        isConnected = (status === 'ì—°ê²°ë¨');

        if (isConnected) {
            document.getElementById('connectionStatus').style.color = 'green';
        } else {
            document.getElementById('connectionStatus').style.color = 'red';
        }
    }

    function connect() {
        currentUserEmail = document.getElementById('senderEmail').value;
        console.log('=== WebSocket ì—°ê²° ì‹œì‘ ===');
        console.log('ì‚¬ìš©ì ì´ë©”ì¼:', currentUserEmail);

        // SockJS ì—°ê²° (í—¤ë” ì œê±°)
        var socket = new SockJS('/chat');
        stompClient = Stomp.over(socket);

        // ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”
        stompClient.debug = function(str) {
            console.log('STOMP Debug:', str);
        };

        // STOMP connect ì‹œ ì‚¬ìš©ì ì •ë³´ë¥¼ í—¤ë”ì— í¬í•¨
        var connectHeaders = {
            'user-email': currentUserEmail
        };
        console.log('STOMP ì—°ê²° í—¤ë”:', connectHeaders);

        stompClient.connect(connectHeaders, function (frame) {
            console.log('=== WebSocket ì—°ê²° ì„±ê³µ ===');
            console.log('Connected frame:', frame);
            console.log('User principal:', frame.headers['user-name']);
            updateConnectionStatus('ì—°ê²°ë¨');

            // ì „ì—­ ì—ëŸ¬ ë©”ì‹œì§€ êµ¬ë…
            stompClient.subscribe('/user/queue/error', function (errorMessage) {
                console.log('Error message received:', errorMessage);
                showErrorMessage(JSON.parse(errorMessage.body));
            });

            addSystemMessage('WebSocket ì—°ê²° ì„±ê³µ');
            addSystemMessage('ì‚¬ìš©ì: ' + frame.headers['user-name']);

        }, function(error) {
            console.log('=== WebSocket ì—°ê²° ì‹¤íŒ¨ ===');
            console.log('Connection error:', error);
            updateConnectionStatus('ì—°ê²° ì‹¤íŒ¨');
            addSystemMessage('WebSocket ì—°ê²° ì‹¤íŒ¨: ' + error);
        });
    }

    var currentSubscription = null; // í˜„ì¬ êµ¬ë… ì •ë³´ ì €ì¥

    async function createAndJoinChatRoom() {
        var postId = document.getElementById('postId').value;
        var senderName = document.getElementById('senderName').value;
        var senderEmail = document.getElementById('senderEmail').value;
        var jwtToken = document.getElementById('jwtToken').value;

        if (!postId || !senderName || !senderEmail || !jwtToken) {
            alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }

        if (!isConnected) {
            alert('WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
            return;
        }

        document.getElementById('createBtn').disabled = true;

        try {
            console.log('=== ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ ì‹œì‘ ===');
            console.log('ê²Œì‹œê¸€ ID:', postId);
            console.log('ì‚¬ìš©ì ì´ë©”ì¼:', senderEmail);

            // ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ API í˜¸ì¶œ
            const response = await fetch(`/api/chat/rooms/${postId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + jwtToken
                }
            });

            if (response.ok) {
                const result = await response.json();
                console.log('ì„œë²„ ì‘ë‹µ:', result);

                const receivedChatRoomId = result.data;

                // ì´ë¯¸ ê°™ì€ ì±„íŒ…ë°©ì— ì°¸ì—¬ ì¤‘ì¸ ê²½ìš° ì¤‘ë³µ êµ¬ë… ë°©ì§€
                if (currentChatRoomId === receivedChatRoomId && currentSubscription) {
                    console.log('âš ï¸ ì´ë¯¸ ê°™ì€ ì±„íŒ…ë°©ì— ì°¸ì—¬ ì¤‘ì…ë‹ˆë‹¤.');
                    addSystemMessage('ì´ë¯¸ ì±„íŒ…ë°© ' + receivedChatRoomId + 'ì— ì°¸ì—¬ ì¤‘ì…ë‹ˆë‹¤.');
                    return;
                }

                // ê¸°ì¡´ êµ¬ë…ì´ ìˆìœ¼ë©´ í•´ì œ
                if (currentSubscription) {
                    console.log('ê¸°ì¡´ êµ¬ë… í•´ì œ:', currentChatRoomId);
                    currentSubscription.unsubscribe();
                    currentSubscription = null;
                }

                // ìƒˆ ì±„íŒ…ë°© ì •ë³´ ì„¤ì •
                currentChatRoomId = receivedChatRoomId;
                updateCurrentChatRoom(currentChatRoomId);

                // WebSocket êµ¬ë… ì„¤ì •
                const subscriptionPath = '/topic/chat/' + currentChatRoomId;
                console.log('=== WebSocket êµ¬ë… ì„¤ì • ===');
                console.log('êµ¬ë… ê²½ë¡œ:', subscriptionPath);
                console.log('ì±„íŒ…ë°© ID:', currentChatRoomId);

                currentSubscription = stompClient.subscribe(subscriptionPath, function (chatMessage) {
                    console.log('=== WebSocket ë©”ì‹œì§€ ìˆ˜ì‹  ===');
                    console.log('Raw message:', chatMessage);
                    console.log('Message body:', chatMessage.body);

                    try {
                        const parsedMessage = JSON.parse(chatMessage.body);
                        console.log('Parsed message:', parsedMessage);
                        showMessage(parsedMessage);
                    } catch (e) {
                        console.error('ë©”ì‹œì§€ íŒŒì‹± ì—ëŸ¬:', e);
                    }
                });

                console.log('âœ… WebSocket êµ¬ë… ì™„ë£Œ');

                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                if (currentChatRoomId) {
                    addSystemMessage('âœ… ì±„íŒ…ë°© ì°¸ì—¬ ì„±ê³µ! (ID: ' + currentChatRoomId + ')');
                    addSystemMessage('ğŸ“¡ WebSocket êµ¬ë… ì™„ë£Œ: ' + subscriptionPath);
                    addSystemMessage('ğŸ’¬ ì´ì œ ì‹¤ì‹œê°„ ì±„íŒ…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!');
                }

                // UI í™œì„±í™”
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('historyBtn').disabled = false;

                // ì±„íŒ… ê¸°ë¡ ìë™ ë¡œë“œ
                setTimeout(() => {
                    addSystemMessage('ğŸ“‹ ì±„íŒ… ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤...');
                    loadChatHistory();
                }, 500);

            } else {
                const errorText = await response.text();
                console.error('ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ ì‹¤íŒ¨:', errorText);
                addErrorMessage('ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ ì‹¤íŒ¨: ' + errorText);
            }

        } catch (error) {
            console.error('ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ ì¤‘ ì˜¤ë¥˜:', error);
            addErrorMessage('ì±„íŒ…ë°© ìƒì„±/ì°¸ì—¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
        } finally {
            document.getElementById('createBtn').disabled = false;
        }
    }

    async function loadMyChatRooms() {
        var jwtToken = document.getElementById('jwtToken').value;

        if (!jwtToken) {
            alert('JWT í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }

        try {
            const response = await fetch('/api/chat/rooms/my', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + jwtToken
                }
            });

            if (response.ok) {
                const result = await response.json();
                console.log('My chat rooms:', result);

                addSystemMessage('=== ë‚´ ì±„íŒ…ë°© ëª©ë¡ ===');
                if (result.data && result.data.length > 0) {
                    result.data.forEach(room => {
                        addSystemMessage(`ë°© ID: ${room.id}, ì´ë¦„: ${room.name}, ë§ˆì§€ë§‰ ë©”ì‹œì§€: ${room.lastContent}`);
                    });
                } else {
                    addSystemMessage('ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.');
                }
                addSystemMessage('==================');

            } else {
                const errorText = await response.text();
                addErrorMessage('ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ' + errorText);
            }
        } catch (error) {
            addErrorMessage('ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: ' + error.message);
        }
    }

    async function loadChatHistory() {
        console.log('=== loadChatHistory ì‹œì‘ ===');
        console.log('currentChatRoomId:', currentChatRoomId);

        if (!currentChatRoomId) {
            alert('ë¨¼ì € ì±„íŒ…ë°©ì— ì°¸ì—¬í•´ì£¼ì„¸ìš”!');
            return;
        }

        var jwtToken = document.getElementById('jwtToken').value;
        console.log('JWT Token exists:', !!jwtToken);

        document.getElementById('historyBtn').disabled = true;

        try {
            // ê¸°ë³¸ API í˜¸ì¶œ (í˜ì´ì§• ì œê±°)
            const url = `/api/chat/rooms/${currentChatRoomId}/messages`;
            console.log('API í˜¸ì¶œ URL:', url);

            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + jwtToken
                }
            });

            console.log('Response status:', response.status);
            console.log('Response ok:', response.ok);

            if (response.ok) {
                const result = await response.json();
                console.log('Chat history ì‘ë‹µ:', result);

                if (result.data && result.data.length > 0) {
                    addSystemMessage(`=== ì±„íŒ… ê¸°ë¡ (ì´ ${result.data.length}ê°œ) ===`);

                    result.data.forEach((message, index) => {
                        console.log(`ë©”ì‹œì§€ ${index}:`, message);
                        showHistoryMessage(message);
                    });

                    addSystemMessage('================');
                } else {
                    console.log('ë©”ì‹œì§€ê°€ ì—†ìŒ');
                    addSystemMessage('ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

            } else {
                const errorText = await response.text();
                console.error('API ì—ëŸ¬ ì‘ë‹µ:', errorText);
                addErrorMessage('ì±„íŒ… ê¸°ë¡ ì¡°íšŒ ì‹¤íŒ¨: ' + errorText);
            }
        } catch (error) {
            console.error('loadChatHistory catch ì—ëŸ¬:', error);
            addErrorMessage('ì±„íŒ… ê¸°ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: ' + error.message);
        } finally {
            document.getElementById('historyBtn').disabled = false;
            console.log('=== loadChatHistory ì™„ë£Œ ===');
        }
    }

    function showHistoryMessage(message) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('div');
        messageElement.className = 'message';

        var currentEmail = document.getElementById('senderEmail').value;
        var isMyMessage = message.senderEmail === currentEmail;

        if (isMyMessage) {
            messageElement.className += ' my-message';
            messageElement.innerHTML = `<strong>ë‚˜:</strong> ${message.content} <small style="color: #999;">(ê¸°ë¡)</small>`;
        } else {
            messageElement.className += ' other-message';
            messageElement.innerHTML = `<strong>${message.senderName}:</strong> ${message.content} <small style="color: #999;">(ê¸°ë¡)</small>`;
        }

        // íˆìŠ¤í† ë¦¬ ë©”ì‹œì§€ë„ ì•„ë˜ì— ì¶”ê°€ (ìµœì‹ ì´ ì•„ë˜ë¡œ)
        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;
    }

    function sendMessage() {
        var senderName = document.getElementById('senderName').value;
        var senderEmail = document.getElementById('senderEmail').value;
        var message = document.getElementById('messageInput').value;

        console.log('=== sendMessage ì‹œì‘ ===');
        console.log('ë°œì‹ ì:', senderName, senderEmail);
        console.log('ë©”ì‹œì§€:', message);
        console.log('ì±„íŒ…ë°© ID:', currentChatRoomId);

        if (!currentChatRoomId) {
            alert('ë¨¼ì € ì±„íŒ…ë°©ì— ì°¸ì—¬í•´ì£¼ì„¸ìš”!');
            return;
        }

        if (!message.trim()) {
            alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }

        if (!isConnected || !stompClient) {
            alert('WebSocket ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
            return;
        }

        const messageData = {
            'senderName': senderName,
            'senderEmail': senderEmail,
            'content': message,
            'chatRoomId': parseInt(currentChatRoomId),
            'senderId': getCurrentUserId() // JWTì—ì„œ ì‚¬ìš©ì ID ì¶”ì¶œ
        };

        console.log('ì „ì†¡í•  ë©”ì‹œì§€ ë°ì´í„°:', messageData);

        // ë‚´ ë©”ì‹œì§€ë¥¼ ì¦‰ì‹œ í™”ë©´ì— í‘œì‹œ
        showMessage(messageData, true); // true = ë‚´ ë©”ì‹œì§€ì„ì„ í‘œì‹œ
        console.log('ë‚´ ë©”ì‹œì§€ ì¦‰ì‹œ í‘œì‹œ ì™„ë£Œ');

        console.log('WebSocketìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡ ì¤‘...');
        stompClient.send("/app/sendMessage", {}, JSON.stringify(messageData));
        console.log('WebSocket ì „ì†¡ ì™„ë£Œ');

        // ë©”ì‹œì§€ ì…ë ¥ì°½ í´ë¦¬ì–´
        document.getElementById('messageInput').value = '';
    }

    function getCurrentUserId() {
        // JWT í† í°ì—ì„œ ì‚¬ìš©ì ID ì¶”ì¶œ (ì‹¤ì œë¡œëŠ” JWT íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¶Œì¥)
        var jwtToken = document.getElementById('jwtToken').value;
        try {
            var payload = JSON.parse(atob(jwtToken.split('.')[1]));
            return payload.id;
        } catch (e) {
            console.error('JWT íŒŒì‹± ì˜¤ë¥˜:', e);
            return 4; // ê¸°ë³¸ê°’
        }
    }

    function showMessage(message, isMyMessageSent = false) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('div');
        messageElement.className = 'message';

        var currentEmail = document.getElementById('senderEmail').value;
        var isMyMessage = isMyMessageSent || (message.senderEmail === currentEmail);

        // ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€ ë¡œì§ ê°œì„ 
        if (!isMyMessageSent && message.senderEmail === currentEmail) {
            // ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ê°€ ì„œë²„ì—ì„œ ë‹¤ì‹œ ì˜¤ëŠ” ê²½ìš°, ìµœê·¼ 5ê°œ ë©”ì‹œì§€ ì¤‘ì—ì„œ ì¤‘ë³µ ì²´í¬
            var existingMessages = Array.from(messages.children).slice(-5);
            var isDuplicate = existingMessages.some(msg => {
                return msg.textContent &&
                    msg.textContent.includes(message.content) &&
                    msg.classList.contains('my-message') &&
                    !msg.textContent.includes('(ê¸°ë¡)'); // ê¸°ë¡ ë©”ì‹œì§€ëŠ” ì œì™¸
            });

            if (isDuplicate) {
                console.log('ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€:', message.content);
                return; // ì¤‘ë³µ ë©”ì‹œì§€ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
            }
        }

        if (isMyMessage) {
            messageElement.className += ' my-message';
            messageElement.innerHTML = `<strong>ë‚˜:</strong> ${message.content}`;
        } else {
            messageElement.className += ' other-message';
            messageElement.innerHTML = `<strong>${message.senderName}:</strong> ${message.content}`;
        }

        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;

        console.log('ë©”ì‹œì§€ í‘œì‹œ ì™„ë£Œ:', {
            content: message.content,
            sender: message.senderName || message.senderEmail,
            isMyMessage: isMyMessage,
            isMyMessageSent: isMyMessageSent
        });
    }

    function showErrorMessage(error) {
        addErrorMessage("ì‹œìŠ¤í…œ ì˜¤ë¥˜: " + error.content);
    }

    function addSystemMessage(message) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('div');
        messageElement.className = 'message system-message';
        messageElement.textContent = message;
        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;
    }

    function addErrorMessage(message) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('div');
        messageElement.className = 'message error-message';
        messageElement.textContent = message;
        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;
    }

    function updateCurrentChatRoom(roomId) {
        currentChatRoomId = roomId;
        document.getElementById('currentChatRoom').textContent = roomId ? `ë°© ID: ${roomId}` : 'ì—†ìŒ';
    }

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }

    function switchToUser1() {
        document.getElementById('senderName').value = 'ì‚¬ìš©ì1';
        document.getElementById('senderEmail').value = 'user1@user.com';
        document.getElementById('jwtToken').value = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMUB1c2VyLmNvbSIsImlkIjozLCJyb2xlIjoiVVNFUiIsImlhdCI6MTc1Mzc2OTk5NiwiZXhwIjoxNzUzNzcxNzk2fQ.example_token_for_user1';
        addSystemMessage('ğŸ”„ ì‚¬ìš©ì1 (ê²Œì‹œê¸€ ì‘ì„±ì)ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');

        // WebSocket ì¬ì—°ê²°
        if (stompClient && isConnected) {
            addSystemMessage('ğŸ”Œ WebSocket ì¬ì—°ê²° ì¤‘...');
            stompClient.disconnect(() => {
                setTimeout(() => {
                    connect();
                }, 1000);
            });
        }
    }

    function switchToUser2() {
        document.getElementById('senderName').value = 'ì‚¬ìš©ì2';
        document.getElementById('senderEmail').value = 'user2@user.com';
        document.getElementById('jwtToken').value = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMkB1c2VyLmNvbSIsImlkIjo0LCJyb2xlIjoiVVNFUiIsImlhdCI6MTc1Mzc2OTk5NiwiZXhwIjoxNzUzNzcxNzk2fQ.UEmZ7n-r1VstflEaGpdi2fDxKjywJzrN83fkCwh9fkI';
        addSystemMessage('ğŸ”„ ì‚¬ìš©ì2 (ì±„íŒ… ì‹ ì²­ì)ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');

        // WebSocket ì¬ì—°ê²°
        if (stompClient && isConnected) {
            addSystemMessage('ğŸ”Œ WebSocket ì¬ì—°ê²° ì¤‘...');
            stompClient.disconnect(() => {
                setTimeout(() => {
                    connect();
                }, 1000);
            });
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì—°ê²°
    window.onload = function() {
        updateConnectionStatus('ì—°ê²° ì¤‘...');
        connect();
    };

    // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ì—°ê²° í•´ì œ
    window.onbeforeunload = function() {
        if (stompClient !== null) {
            stompClient.disconnect();
        }
    };
</script>
</body>
</html>
